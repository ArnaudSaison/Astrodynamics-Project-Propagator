function parOUT = processParam(parIN)
% PROCESSPARAM processes parameters
% 
% Inputs:
%   parIN = user parameters structure generated by 'parameters.m'
% 
% Outputs:
%   parOUT = 
%       processed parameters that can be used for the simulation. The goal
%       is that no parameter should be hardcoded
% 

% User parameters
par = parIN; % copy user parameters

% Add physical constants and data (used later in the function)
par.pdata = planetaryData();

% Create derived variables
par.tspan = linspace(0, par.T_END, par.N_STEP + 1);

% Dev
if par.DEBUG
    par.displ_stats = 'on';
else
    par.displ_stats = 'off';
end

% TLE
if isfield(par, 'BULKTLES_FILENAME')
    par.bulkTLEs = processBulkTLEs(par, par.BULKTLES_FILENAME); % all TLEs contained in file
    TLE0 = par.bulkTLEs(1); % initial TLE

    par.TLE.L0 = TLE0.L0;
    par.TLE.L1 = TLE0.L1;
    par.TLE.L2 = TLE0.L2;
    par.TLE.processed = TLE0.processed;
    par.Orb_elem0 = TLE0.elem;
    par.ECI0 = TLE0.ECI;
    
else
    [par.TLE.processed, par.Orb_elem0, par.ECI0] = processTLE(par);
end

% Output
parOUT = par;

end